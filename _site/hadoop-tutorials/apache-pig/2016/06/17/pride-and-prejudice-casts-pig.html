<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Pride and Prejudice - Find which character is famous using Apache PIG</title>
	
	<meta name="description" content="A simple PIG program to count the number of times each characters name has appeared in the book pride and prejudice.">
	
	<meta name="author" content="Omair Aasim">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/omairaasim">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/omairaasim">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:omairaasim@gmail.com">
				<i class="fa fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="/">
				<img src="http://www.gravatar.com/avatar/ded6b2a2d3dcd1039f6fef5313d85cd2?s=35" class="img-circle" />
				Omair Aasim
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/categories.html">Categories</a></li>
				<li><a href="/tags.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs" style="">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="https://s3.amazonaws.com/omairaasim.github.io/images/omairaasim_thumb.jpg?s=150" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="/">Omair Aasim</a>
    </h3>
</header>


<div id="bio" class="text-center">
	Software Engineer by profession - Entrepreneur at heart - CoFounder and CTO at DeZyre
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/omairaasim">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/omairaasim">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:omairaasim@gmail.com">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://pinterest.com/omairaasim">
				<i class="fa fa-pinterest fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://linkedin.com/in/omairaasim">
				<i class="fa fa-linkedin fa-lg"></i>
			</a>
		</li>
		
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>Pride and Prejudice - Find which character is famous using Apache PIG </h1>
</div>

<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   June
	   17th,
	   
	   2016
	 </span>
	  <div class="article_body">
	  <p>In this tutorial, we are going to take the simple word count example and spice it up. We are going to use Apache PIG to determine the number of times each characters name has appeared in the book pride and prejudice.</p>

<p>If you have not installed PIG - please follow the steps in this tutorial.</p>

<ul>
  <li><a href="/hadoop-tutorials/apache-pig/2016/06/15/install-apache-pig.html">Installing Apache PIG on MAC OS</a></li>
</ul>

<p>   <br />
Lets get started !!!</p>

<p> </p>

<p>Just for reference, these are the main characters we are going to look for. I’m going by their first names.</p>

<ul>
  <li>Catherine</li>
  <li>Elizabeth</li>
  <li>Collins</li>
  <li>George</li>
  <li>Jane</li>
  <li>Lydia</li>
  <li>Caroline</li>
  <li>Kitty</li>
  <li>Charles<br />
 </li>
</ul>

<p><strong>Step 1: Download the book</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>wget https://s3.amazonaws.com/omairaasim.github.io/data/pride_and_prejudice.txt
</code></pre>
</div>
<p> </p>

<p><strong>Step 2: Copy the book into HDFS</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>hadoop fs -copyFromLocal /home/hadoop/pride_and_prejudice.txt /data/pig/pride_and_prejudice.txt
</code></pre>
</div>
<p> </p>

<p><strong>Step 3: Load the data</strong></p>

<p>Start pig and load the data</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pnp_book = LOAD '/data/pig/pride_and_prejudice.txt' AS (lines:chararray);
</code></pre>
</div>
<p> </p>

<p><strong>Step 4: Tokenize the data</strong></p>

<p>Lets tokenize and flatten the data so we get one word in each line. Also in this step - I’m replacing all punctuation marks and (“’s’”). If we don’t do that, then when we tokenize - these 3 would be considered as separate tokens</p>

<ul>
  <li>Elizabeth</li>
  <li>Elizabeth.</li>
  <li>Elizabeth’s</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>tokens = FOREACH pnp_book GENERATE FLATTEN (TOKENIZE(REPLACE(lines, '\'[s]|[\\.;,!:]',''))) AS word;
</code></pre>
</div>
<p> </p>

<p><strong>Step 5: Filter the data</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>character_names = FILTER tokens BY
                                (
                                    LOWER(word) matches LOWER('Elizabeth') OR  
                                    LOWER(word) matches LOWER('Collins') OR
                                    LOWER(word) matches LOWER('George') OR  
                                    LOWER(word) matches LOWER('Jane') OR
                                    LOWER(word) matches LOWER('Lydia') OR  
                                    LOWER(word) matches LOWER('Caroline') OR
                                    LOWER(word) matches LOWER('Kitty') OR  
                                    LOWER(word) matches LOWER('Charles')
                                );
</code></pre>
</div>
<p> </p>

<p><strong>Step 6: Group the words together</strong></p>

<p>Next we will group the words</p>

<div class="highlighter-rouge"><pre class="highlight"><code>group_by_name = GROUP character_names BY LOWER(word);
</code></pre>
</div>
<p> </p>

<p><strong>Step 7: Count the occurrences</strong></p>

<p>Next we will count the number of times each character name has occurred</p>

<div class="highlighter-rouge"><pre class="highlight"><code>count_names = FOREACH group_by_name GENERATE group, COUNT(character_names) as total_count;
</code></pre>
</div>
<p> </p>

<p><strong>Step 8: Order by max count</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>order_count = ORDER count_names BY total_count DESC;
</code></pre>
</div>
<p> </p>

<p><strong>Step 9: Save the script</strong></p>

<p>Lets save it as a pride_and_prejudice.pig file</p>

<div class="highlighter-rouge"><pre class="highlight"><code>STORE order_count INTO '/output/pig/pride_and_prejudice';
</code></pre>
</div>
<p> </p>

<p><strong>Step 10: Output</strong></p>

<p>The output is saved in the hdfs folder we specified in step 9. To view the results - you can use this command.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>hadoop fs -cat /output/pig/pride_and_prejudice/part-r-00000
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>elizabeth 633
jane      293
collins	  180
lydia	  170
kitty	   70
caroline   17
george      8
charles	    7
</code></pre>
</div>
<p> </p>

<p><strong>Here is the complete script</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>pnp_book = LOAD '/data/pig/pride_and_prejudice.txt' AS (lines:chararray);
tokens = FOREACH pnp_book GENERATE FLATTEN (TOKENIZE(REPLACE(lines, '\'[s]|[\\.;,!:]',''))) AS word;
character_names = FILTER tokens BY
                                (
                                    LOWER(word) matches LOWER('Elizabeth') OR  
                                    LOWER(word) matches LOWER('Collins') OR
                                    LOWER(word) matches LOWER('George') OR  
                                    LOWER(word) matches LOWER('Jane') OR
                                    LOWER(word) matches LOWER('Lydia') OR  
                                    LOWER(word) matches LOWER('Caroline') OR
                                    LOWER(word) matches LOWER('Kitty') OR  
                                    LOWER(word) matches LOWER('Charles')
                                );
group_by_name = GROUP character_names BY LOWER(word);
count_names = FOREACH group_by_name GENERATE group, COUNT(character_names) as total_count;
order_count = ORDER count_names BY total_count DESC;
STORE order_count INTO '/output/pig/pride_and_prejudice';
</code></pre>
</div>
<p> </p>

<p>As you can see - this is nothing but an extension of word count program but we’ve used it to do a simple analysis.</p>

	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			
				<li><a href="/categories.html#hadoop-tutorials-ref">
					hadoop-tutorials <span>(7)</span>
					,
				</a></li>
			
				<li><a href="/categories.html#apache-pig-ref">
					apache-pig <span>(4)</span>
					
				</a></li>
			
		  
		</ul>
		

		
		<ul class="list-inline">
		  <li><i class="fa fa-tags"></i></li>
		  
		  
			
				<li>
					<a href="/tags.html#pig-ref">
					pig <span>(4)</span>
					
					</a>
				</li>
			
		  
		  
		</ul>
		

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=Pride and Prejudice - Find which character is famous using Apache PIG&via=omairaasim"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

    
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/hadoop-tutorials/apache-pig/2016/06/16/word-count-using-apache-pig.html" title="Word count example doing using Apache PIG">&larr; Previous</a></li>
		  
		  
		  <li class="next"><a href="/hadoop-tutorials/apache-pig/2016/06/20/top-growing-nasdaq-companies-pig.html" title="Find the top growing companies in Nasdaq using Apache PIG">Next &rarr;</a></li>
		  
		</ul>

		<hr>
	</div>

	<div class="col-sm-2 sidebar-2">

	</div>
</article>
<div class="clearfix"></div>



    
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'omairaasim';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>





		
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
</body>
</html>



<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-26773104-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

